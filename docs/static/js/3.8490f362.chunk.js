(this.webpackJsonptsume_cube_react=this.webpackJsonptsume_cube_react||[]).push([[3],{173:function(e,t,r){"use strict";r.r(t),r.d(t,"Orbit",(function(){return b})),r.d(t,"OrbitDef",(function(){return g})),r.d(t,"OrbitsDef",(function(){return d})),r.d(t,"Perm",(function(){return p})),r.d(t,"PuzzleGeometry",(function(){return te})),r.d(t,"Quat",(function(){return U})),r.d(t,"Transformation",(function(){return w})),r.d(t,"VisibleState",(function(){return k})),r.d(t,"getPuzzleGeometryByDesc",(function(){return Q})),r.d(t,"getPuzzleGeometryByName",(function(){return H})),r.d(t,"getpuzzle",(function(){return J})),r.d(t,"getpuzzles",(function(){return W})),r.d(t,"parsedesc",(function(){return V})),r.d(t,"schreierSims",(function(){return ne})),r.d(t,"useNewFaceNames",(function(){return q}));var i=r(13),n=r(16),s=r(5),a=r(6),o=r(1),h=r(2),f=r(3),u=[],l=[];function c(e){if(!u[e]){for(var t=Array(e),r=0;r<e;r++)t[r]=0;u[e]=t}return u[e]}function v(e){if(!l[e]){for(var t=Array(e),r=0;r<e;r++)t[r]=r;l[e]=t}return l[e]}function m(e,t){return e/function(e,t){if(e>t){var r=e;e=t,t=r}for(;e>0;){var i=t%e;t=e,e=i}return t}(e,t)*t}var p=function(){function e(t){Object(o.a)(this,e),this.n=t.length,this.p=t}return Object(h.a)(e,[{key:"toString",value:function(){return"Perm["+this.p.join(" ")+"]"}},{key:"mul",value:function(t){for(var r=Array(this.n),i=0;i<this.n;i++)r[i]=t.p[this.p[i]];return new e(r)}},{key:"rmul",value:function(t){for(var r=Array(this.n),i=0;i<this.n;i++)r[i]=this.p[t.p[i]];return new e(r)}},{key:"inv",value:function(){for(var t=Array(this.n),r=0;r<this.n;r++)t[this.p[r]]=r;return new e(t)}},{key:"compareTo",value:function(e){for(var t=0;t<this.n;t++)if(this.p[t]!==e.p[t])return this.p[t]-e.p[t];return 0}},{key:"toGap",value:function(){for(var e=new Array,t=new Array(this.n),r=0;r<this.p.length;r++)if(!t[r]&&this.p[r]!==r){for(var i=new Array,n=r;!t[n];n=this.p[n])i.push(1+n),t[n]=!0;e.push("("+i.join(",")+")")}return e.join("")}},{key:"order",value:function(){for(var e=1,t=new Array(this.n),r=0;r<this.p.length;r++)if(!t[r]&&this.p[r]!==r){for(var i=0,n=r;!t[n];n=this.p[n])i++,t[n]=!0;e=m(e,i)}return e}}]),e}(),g=function(){function e(t,r){Object(o.a)(this,e),this.size=t,this.mod=r}return Object(h.a)(e,[{key:"reassemblySize",value:function(){return function(e){for(var t=1;e>1;)t*=e,e--;return t}(this.size)*Math.pow(this.mod,this.size)}}]),e}(),d=function(){function e(t,r,i,n,s){Object(o.a)(this,e),this.orbitnames=t,this.orbitdefs=r,this.solved=i,this.movenames=n,this.moveops=s}return Object(h.a)(e,[{key:"transformToKPuzzle",value:function(e){for(var t={},r=0;r<this.orbitnames.length;r++)t[this.orbitnames[r]]=e.orbits[r].toKpuzzle();return t}},{key:"toKsolve",value:function(e,t){var r=[];r.push("Name "+e),r.push("");for(var i=0;i<this.orbitnames.length;i++)r.push("Set "+this.orbitnames[i]+" "+this.orbitdefs[i].size+" "+this.orbitdefs[i].mod);r.push(""),r.push("Solved");for(var n=0;n<this.orbitnames.length;n++){r.push(this.orbitnames[n]);var s=this.solved.orbits[n].toKsolveVS();r.push(s[0]),r.push(s[1])}r.push("End"),r.push("");for(var a=0;a<this.movenames.length;a++){r.push("Move "+this.movenames[a]);for(var o=0;o<this.orbitnames.length;o++)if(t||!this.moveops[a].orbits[o].isIdentity()){r.push(this.orbitnames[o]);var h=this.moveops[a].orbits[o].toKsolve();r.push(h[0]),r.push(h[1])}r.push("End"),r.push("")}return r}},{key:"toKpuzzle",value:function(){for(var e={},t={},r=0;r<this.orbitnames.length;r++)e[this.orbitnames[r]]={numPieces:this.orbitdefs[r].size,orientations:this.orbitdefs[r].mod},t[this.orbitnames[r]]=this.solved.orbits[r].toKpuzzle();for(var i={},n=0;n<this.movenames.length;n++)i[this.movenames[n]]=this.transformToKPuzzle(this.moveops[n]);return{name:"PG3D",orbits:e,startPieces:t,moves:i}}},{key:"optimize",value:function(){for(var t=[],r=[],i=[],n=[],s=0;s<this.moveops.length;s++)n.push([]);for(var a=0;a<this.orbitdefs.length;a++){for(var o=this.orbitdefs[a].mod,h=this.orbitdefs[a].size,f=new L(h),u=new Array(this.orbitdefs[a].size),l=0;l<h;l++)u[l]=!1;for(var c=0;c<this.moveops.length;c++)for(var v=0;v<h;v++)this.moveops[c].orbits[a].perm[v]===v&&0===this.moveops[c].orbits[a].ori[v]||(u[v]=!0,f.union(v,this.moveops[c].orbits[a].perm[v]));var m=!0;if(o>1){m=!1;for(var p=new L(this.orbitdefs[a].size*o),d=0;d<this.moveops.length;d++)for(var b=0;b<h;b++)if(this.moveops[d].orbits[a].perm[b]!==b||0!==this.moveops[d].orbits[a].ori[b])for(var y=0;y<o;y++)p.union(b*o+y,this.moveops[d].orbits[a].perm[b]*o+(y+this.moveops[d].orbits[a].ori[b])%o);for(var z=0;!m&&z<h;z++)for(var x=1;x<o;x++)p.find(z*o)===p.find(z*o+x)&&(m=!0);for(var M=0;!m&&M<h;M++)for(var F=0;F<M;F++)this.solved.orbits[a].perm[M]===this.solved.orbits[a].perm[F]&&(m=!0)}for(var A=-1,B=!1,R=0;R<this.orbitdefs[a].size;R++)if(u[R]){var O=f.find(R);A<0?A=O:A!==O&&(B=!0)}for(var j=0;j<this.orbitdefs[a].size;j++){if(u[j])if(f.find(j)===j){for(var D=[],E=[],C=0,N=0;N<this.orbitdefs[a].size;N++)f.find(N)===j&&(D[C]=N,E[N]=C,C++);if(B?t.push(this.orbitnames[a]+"_p"+j):t.push(this.orbitnames[a]),m){r.push(new g(C,this.orbitdefs[a].mod)),i.push(this.solved.orbits[a].remapVS(D,C));for(var P=0;P<this.moveops.length;P++)n[P].push(this.moveops[P].orbits[a].remap(D,E,C))}else{r.push(new g(C,1)),i.push(this.solved.orbits[a].remapVS(D,C).killOri());for(var U=0;U<this.moveops.length;U++)n[U].push(this.moveops[U].orbits[a].remap(D,E,C).killOri())}}}}return new e(t,r,new k(i),this.movenames,n.map((function(e){return new w(e)})))}},{key:"scramble",value:function(e){for(var t=[],r=0;r<this.moveops.length;r++)t[r]=this.moveops[r];for(var i=0;i<t.length;i++){var n=Math.floor(Math.random()*t.length),s=t[i];t[i]=t[n],t[n]=s}e<t.length&&(e=t.length);for(var a=0;a<e;a++){var o=Math.floor(Math.random()*t.length),h=Math.floor(Math.random()*t.length),f=Math.floor(Math.random()*this.moveops.length);t[o]=t[o].mul(t[h]).mul(this.moveops[f]),Math.random()<.1&&(t[o]=t[o].mul(this.moveops[f]))}for(var u=t[0],l=1;l<t.length;l++)u=u.mul(t[l]);this.solved=this.solved.mul(u)}},{key:"reassemblySize",value:function(){for(var e=1,t=0;t<this.orbitdefs.length;t++)e*=this.orbitdefs[t].reassemblySize();return e}}],[{key:"transformToKPuzzle",value:function(e,t){for(var r={},i=0;i<e.length;i++)r[e[i]]=t.orbits[i].toKpuzzle();return r}}]),e}(),b=function(){function e(t,r,i){Object(o.a)(this,e),this.perm=t,this.ori=r,this.orimod=i}return Object(h.a)(e,[{key:"mul",value:function(t){var r=this.perm.length,i=new Array(r);if(1===this.orimod){for(var n=0;n<r;n++)i[n]=this.perm[t.perm[n]];return new e(i,this.ori,this.orimod)}for(var s=new Array(r),a=0;a<r;a++)i[a]=this.perm[t.perm[a]],s[a]=(this.ori[t.perm[a]]+t.ori[a])%this.orimod;return new e(i,s,this.orimod)}},{key:"inv",value:function(){for(var t=this.perm.length,r=new Array(t),i=new Array(t),n=0;n<t;n++)r[this.perm[n]]=n,i[this.perm[n]]=(this.orimod-this.ori[n])%this.orimod;return new e(r,i,this.orimod)}},{key:"equal",value:function(e){for(var t=this.perm.length,r=0;r<t;r++)if(this.perm[r]!==e.perm[r]||this.ori[r]!==e.ori[r])return!1;return!0}},{key:"killOri",value:function(){for(var e=this.perm.length,t=0;t<e;t++)this.ori[t]=0;return this.orimod=1,this}},{key:"toPerm",value:function(){var e=this.orimod;if(1===e)return new p(this.perm);for(var t=this.perm.length,r=new Array(t*e),i=0;i<t;i++)for(var n=0;n<e;n++)r[i*e+n]=e*this.perm[i]+(this.ori[i]+n)%e;return new p(r)}},{key:"identicalPieces",value:function(){for(var e=[],t=this.perm.length,r=[],i=0;i<t;i++){var n=this.perm[i];if(void 0===e[n]){var s=[i];e[n]=!0;for(var a=i+1;a<t;a++)this.perm[a]===n&&s.push(a);r.push(s)}}return r}},{key:"order",value:function(){return this.toPerm().order()}},{key:"isIdentity",value:function(){var e=this.perm.length;if(this.perm===v(e)&&this.ori===c(e))return!0;for(var t=0;t<e;t++)if(this.perm[t]!==t||0!==this.ori[t])return!1;return!0}},{key:"remap",value:function(t,r,i){for(var n=new Array(i),s=new Array(i),a=0;a<i;a++)n[a]=r[this.perm[t[a]]],s[a]=this.ori[t[a]];return new e(n,s,this.orimod)}},{key:"remapVS",value:function(t,r){for(var i=new Array(r),n=new Array(r),s=0,a=[],o=0;o<r;o++){var h=this.perm[t[o]];void 0===a[h]&&(a[h]=s++),i[o]=a[h],n[o]=this.ori[t[o]]}return new e(i,n,this.orimod)}},{key:"toKsolveVS",value:function(){return[this.perm.map((function(e){return e+1})).join(" "),this.ori.join(" ")]}},{key:"toKsolve",value:function(){for(var e=new Array(this.ori.length),t=0;t<e.length;t++)e[this.perm[t]]=this.ori[t];return[this.perm.map((function(e){return e+1})).join(" "),e.join(" ")]}},{key:"toKpuzzle",value:function(){var t=this.perm.length;return this.isIdentity()?(e.kcache[t]||(e.kcache[t]={permutation:v(t),orientation:c(t)}),e.kcache[t]):{permutation:this.perm,orientation:this.ori}}}],[{key:"e",value:function(t,r){return new e(v(t),c(t),r)}}]),e}();b.kcache=[];var y=function(){function e(t){Object(o.a)(this,e),this.orbits=t}return Object(h.a)(e,[{key:"internalMul",value:function(e){for(var t=[],r=0;r<this.orbits.length;r++)t.push(this.orbits[r].mul(e.orbits[r]));return t}},{key:"internalInv",value:function(){for(var e=[],t=0;t<this.orbits.length;t++)e.push(this.orbits[t].inv());return e}},{key:"equal",value:function(e){for(var t=0;t<this.orbits.length;t++)if(!this.orbits[t].equal(e.orbits[t]))return!1;return!0}},{key:"killOri",value:function(){for(var e=0;e<this.orbits.length;e++)this.orbits[e].killOri();return this}},{key:"toPerm",value:function(){for(var e=new Array,t=0,r=0;r<this.orbits.length;r++){var i=this.orbits[r].toPerm();e.push(i),t+=i.n}var n=new Array(t);t=0;for(var s=0;s<this.orbits.length;s++){for(var a=e[s],o=0;o<a.n;o++)n[t+o]=t+a.p[o];t+=a.n}return new p(n)}},{key:"identicalPieces",value:function(){for(var e=this,t=[],r=0,i=function(i){for(var n=e.orbits[i].orimod,s=e.orbits[i].identicalPieces(),a=0;a<s.length;a++)t.push(s[a].map((function(e){return e*n+r})));r+=n*e.orbits[i].perm.length},n=0;n<this.orbits.length;n++)i(n);return t}},{key:"order",value:function(){for(var e=1,t=0;t<this.orbits.length;t++)e=m(e,this.orbits[t].order());return e}}]),e}(),w=function(e){Object(s.a)(r,e);var t=Object(a.a)(r);function r(e){return Object(o.a)(this,r),t.call(this,e)}return Object(h.a)(r,[{key:"mul",value:function(e){return new r(this.internalMul(e))}},{key:"mulScalar",value:function(e){if(0===e)return this.e();var t=this;for(e<0&&(t=t.inv(),e=-e);0===(1&e);)t=t.mul(t),e>>=1;if(1===e)return t;for(var r=t,i=this.e();e>0;)1&e&&(i=i.mul(r)),e>1&&(r=r.mul(r)),e>>=1;return i}},{key:"inv",value:function(){return new r(this.internalInv())}},{key:"e",value:function(){return new r(this.orbits.map((function(e){return b.e(e.perm.length,e.orimod)})))}}]),r}(y),k=function(e){Object(s.a)(r,e);var t=Object(a.a)(r);function r(e){return Object(o.a)(this,r),t.call(this,e)}return Object(h.a)(r,[{key:"mul",value:function(e){return new r(this.internalMul(e))}}]),r}(y),L=function(){function e(t){Object(o.a)(this,e),this.n=t,this.heads=new Array(t);for(var r=0;r<t;r++)this.heads[r]=r}return Object(h.a)(e,[{key:"find",value:function(e){var t=this.heads[e];return this.heads[t]===t||(t=this.find(this.heads[t]),this.heads[e]=t),t}},{key:"union",value:function(e,t){var r=this.find(e),i=this.find(t);r<i?this.heads[i]=r:r>i&&(this.heads[r]=i)}}]),e}();var z=function(){function e(t,r){Object(o.a)(this,e),this.facenames=t,this.prefixFree=!0,this.gripnames=[],r&&(this.gripnames=r);for(var i=0;this.prefixFree&&i<t.length;i++)for(var n=0;this.prefixFree&&n<t.length;n++)i!==n&&t[i].startsWith(t[n])&&(this.prefixFree=!1)}return Object(h.a)(e,[{key:"setGripNames",value:function(e){this.gripnames=e}},{key:"splitByFaceNames",value:function(e){for(var t=[],r=0;r<e.length;){r>0&&r<e.length&&"_"===e[r]&&r++;for(var i=-1,n=0;n<this.facenames.length;n++)e.substr(r).startsWith(this.facenames[n])&&(i<0||this.facenames[n].length>this.facenames[i].length)&&(i=n);if(!(i>=0))throw new Error("Could not split "+e+" into face names.");t.push(i),r+=this.facenames[i].length}return t}},{key:"joinByFaceIndices",value:function(e){for(var t="",r=[],i=0;i<e.length;i++)r.push(t),r.push(this.facenames[e[i]]),this.prefixFree||(t="_");return r.join("")}},{key:"spinmatch",value:function(e,t){if(e===t)return!0;try{var r=this.splitByFaceNames(e),i=this.splitByFaceNames(t);if(r.length!==i.length&&r.length<3)return!1;for(var n=0;n<r.length;n++){for(var s=0;s<n;s++)if(r[n]===r[s])return!1;for(var a=!1,o=0;o<i.length;o++)if(r[n]===i[o]){a=!0;break}if(!a)return!1}return!0}catch(h){return!1}}},{key:"unswizzle",value:function(e){(e.endsWith("v")||e.endsWith("w"))&&e[0]<="Z"&&(e=e.slice(0,e.length-1));for(var t=e.toUpperCase(),r=0;r<this.gripnames.length;r++){var i=this.gripnames[r];if(this.spinmatch(t,i))return i}return e}}]),e}(),x=function(){function e(){Object(o.a)(this,e)}return Object(h.a)(e,[{key:"notationToInternal",value:function(e){return e}},{key:"notationToExternal",value:function(e){return e}}]),e}();function M(e,t){return t=void 0===t?-1:-1===t?void 0:-t,new f.f(e,t)}var F=function(){function e(t){Object(o.a)(this,e),this.slices=t}return Object(h.a)(e,[{key:"notationToInternal",value:function(e){var t=e.family;return e.innerLayer||e.outerLayer||("x"===t?e=new f.f("Rv",e.effectiveAmount):"y"===t?e=new f.f("Uv",e.effectiveAmount):"z"===t&&(e=new f.f("Fv",e.effectiveAmount)),1===(1&this.slices)&&("E"===t?e=new f.f(new f.g("D",(this.slices+1)/2),e.effectiveAmount):"M"===t?e=new f.f(new f.g("L",(this.slices+1)/2),e.effectiveAmount):"S"===t&&(e=new f.f(new f.g("F",(this.slices+1)/2),e.effectiveAmount))),this.slices>2&&("e"===t?e=new f.f(new f.g("D",this.slices-1,2),e.effectiveAmount):"m"===t?e=new f.f(new f.g("L",this.slices-1,2),e.effectiveAmount):"s"===t&&(e=new f.f(new f.g("F",this.slices-1,2),e.effectiveAmount)))),e}},{key:"notationToExternal",value:function(e){var t=e.family;if(!e.innerLayer&&!e.outerLayer){if("Rv"===t)return new f.f("x",e.effectiveAmount);if("Uv"===t)return new f.f("y",e.effectiveAmount);if("Fv"===t)return new f.f("z",e.effectiveAmount);if("Lv"===t)return M("x",e.effectiveAmount);if("Dv"===t)return M("y",e.effectiveAmount);if("Bv"===t)return M("z",e.effectiveAmount)}return e}}]),e}(),A=function(){function e(t,r){Object(o.a)(this,e),this.internalNames=t,this.externalNames=r}return Object(h.a)(e,[{key:"convertString",value:function(e,t,r){var i="";(e.endsWith("v")||e.endsWith("v"))&&e<="_"&&(i=e.slice(e.length-1),e=e.slice(0,e.length-1));var n=e.toUpperCase(),s=!1;return e!==n&&(s=!0,e=n),e=r.joinByFaceIndices(t.splitByFaceNames(e)),s&&(e=e.toLowerCase()),e+i}},{key:"convert",value:function(e,t,r){var i=e.family,n=this.convertString(i,t,r);return i===n?e:new f.f(new f.g(n,e.innerLayer,e.outerLayer),e.effectiveAmount)}},{key:"notationToInternal",value:function(e){return this.convert(e,this.externalNames,this.internalNames)}},{key:"notationToExternal",value:function(e){return this.convert(e,this.internalNames,this.externalNames)}}]),e}(),B=function(){function e(t){Object(o.a)(this,e),this.child=t}return Object(h.a)(e,[{key:"notationToInternal",value:function(e){if(void 0===e.innerLayer&&void 0===e.outerLayer){if(1===Math.abs(e.effectiveAmount)){if("R++"===e.family)return new f.f(new f.g("L",3,2),-2*e.effectiveAmount);if("R--"===e.family)return new f.f(new f.g("L",3,2),2*e.effectiveAmount);if("D++"===e.family)return new f.f(new f.g("U",3,2),-2*e.effectiveAmount);if("D--"===e.family)return new f.f(new f.g("U",3,2),2*e.effectiveAmount)}if("y"===e.family)return new f.f("Uv",e.effectiveAmount)}return this.child.notationToInternal(e)}},{key:"notationToExternal",value:function(e){return"Uv"===e.family?new f.f(new f.g("y",e.innerLayer,e.outerLayer),e.effectiveAmount):"Dv"===e.family?M("y",e.effectiveAmount):this.child.notationToExternal(e)}}]),e}(),R=function(){function e(t){Object(o.a)(this,e),this.child=t}return Object(h.a)(e,[{key:"notationToInternal",value:function(e){return e.innerLayer||e.outerLayer?null:"F"===e.family?new f.f(new f.g("DFR",e.outerLayer,e.innerLayer),e.effectiveAmount):"R"===e.family?new f.f(new f.g("DBR",e.outerLayer,e.innerLayer),e.effectiveAmount):"L"===e.family?new f.f(new f.g("DFL",e.outerLayer,e.innerLayer),e.effectiveAmount):"B"===e.family?new f.f(new f.g("DBL",e.outerLayer,e.innerLayer),e.effectiveAmount):null}},{key:"notationToExternal",value:function(e){return this.child.spinmatch(e.family,"DFR")?new f.f(new f.g("F",e.innerLayer,e.outerLayer),e.effectiveAmount):this.child.spinmatch(e.family,"DRB")?new f.f(new f.g("R",e.innerLayer,e.outerLayer),e.effectiveAmount):this.child.spinmatch(e.family,"DFL")?new f.f(new f.g("L",e.innerLayer,e.outerLayer),e.effectiveAmount):this.child.spinmatch(e.family,"DBL")?new f.f(new f.g("B",e.innerLayer,e.outerLayer),e.effectiveAmount):null}}]),e}(),O=function(){function e(t){Object(o.a)(this,e),this.child=t}return Object(h.a)(e,[{key:"notationToInternal",value:function(e){return e.innerLayer||e.outerLayer?null:"U"===e.family?new f.f(new f.g("flr",e.innerLayer,e.outerLayer),e.effectiveAmount):"R"===e.family?new f.f(new f.g("fld",e.innerLayer,e.outerLayer),e.effectiveAmount):"L"===e.family?new f.f(new f.g("frd",e.innerLayer,e.outerLayer),e.effectiveAmount):"B"===e.family?new f.f(new f.g("dlr",e.innerLayer,e.outerLayer),e.effectiveAmount):"u"===e.family?new f.f(new f.g("FLR",e.innerLayer,e.outerLayer),e.effectiveAmount):"r"===e.family?new f.f(new f.g("FLD",e.innerLayer,e.outerLayer),e.effectiveAmount):"l"===e.family?new f.f(new f.g("FRD",e.innerLayer,e.outerLayer),e.effectiveAmount):"b"===e.family?new f.f(new f.g("DLR",e.innerLayer,e.outerLayer),e.effectiveAmount):"y"===e.family?M("Dv",e.effectiveAmount):null}},{key:"notationToExternal",value:function(e){if(e.family===e.family.toLowerCase()){var t=e.family.toUpperCase();if(this.child.spinmatch(t,"FLR"))return new f.f(new f.g("U",e.innerLayer,e.outerLayer),e.effectiveAmount);if(this.child.spinmatch(t,"FLD"))return new f.f(new f.g("R",e.innerLayer,e.outerLayer),e.effectiveAmount);if(this.child.spinmatch(t,"FRD"))return new f.f(new f.g("L",e.innerLayer,e.outerLayer),e.effectiveAmount);if(this.child.spinmatch(t,"DLR"))return new f.f(new f.g("B",e.innerLayer,e.outerLayer),e.effectiveAmount)}if(e.family===e.family.toUpperCase()){if(this.child.spinmatch(e.family,"FLR"))return new f.f(new f.g("u",e.innerLayer,e.outerLayer),e.effectiveAmount);if(this.child.spinmatch(e.family,"FLD"))return new f.f(new f.g("r",e.innerLayer,e.outerLayer),e.effectiveAmount);if(this.child.spinmatch(e.family,"FRD"))return new f.f(new f.g("l",e.innerLayer,e.outerLayer),e.effectiveAmount);if(this.child.spinmatch(e.family,"DLR"))return new f.f(new f.g("b",e.innerLayer,e.outerLayer),e.effectiveAmount)}return"Dv"===e.family?M("y",e.effectiveAmount):null}}]),e}(),j=function(){function e(t,r){Object(o.a)(this,e),this.child=t,this.sw=r}return Object(h.a)(e,[{key:"notationToInternal",value:function(e){return"T"===e.family&&void 0===e.innerLayer&&void 0===e.outerLayer?new f.f(new f.g("FLRv",e.innerLayer,e.outerLayer),e.effectiveAmount):this.child.notationToInternal(e)}},{key:"notationToExternal",value:function(e){var t=e.family;return t.length>0&&"v"===t[t.length-1]&&(t=t.substring(0,t.length-1)),this.sw.spinmatch(t,"FLUR")?new f.f(new f.g("T",e.innerLayer,e.outerLayer),e.effectiveAmount):this.child.notationToExternal(e)}}]),e}(),D={"2x2x2":"c f 0","3x3x3":"c f 0.333333333333333","4x4x4":"c f 0.5 f 0","5x5x5":"c f 0.6 f 0.2","6x6x6":"c f 0.666666666666667 f 0.333333333333333 f 0","7x7x7":"c f 0.714285714285714 f 0.428571428571429 f 0.142857142857143","8x8x8":"c f 0.75 f 0.5 f 0.25 f 0","9x9x9":"c f 0.777777777777778 f 0.555555555555556 f 0.333333333333333 f 0.111111111111111","10x10x10":"c f 0.8 f 0.6 f 0.4 f 0.2 f 0","11x11x11":"c f 0.818181818181818 f 0.636363636363636 f 0.454545454545455 f 0.272727272727273 f 0.0909090909090909","12x12x12":"c f 0.833333333333333 f 0.666666666666667 f 0.5 f 0.333333333333333 f 0.166666666666667 f 0","13x13x13":"c f 0.846153846153846 f 0.692307692307692 f 0.538461538461538 f 0.384615384615385 f 0.230769230769231 f 0.0769230769230769","20x20x20":"c f 0 f .1 f .2 f .3 f .4 f .5 f .6 f .7 f .8 f .9","30x30x30":"c f 0 f .066667 f .133333 f .2 f .266667 f .333333 f .4 f .466667 f .533333 f .6 f .666667 f .733333 f .8 f .866667 f .933333","40x40x40":"c f 0 f .05 f .1 f .15 f .2 f .25 f .3 f .35 f .4 f .45 f .5 f .55 f .6 f .65 f .7 f .75 f .8 f .85 f .9 f .95",skewb:"c v 0","master skewb":"c v 0.275","professor skewb":"c v 0 v 0.38","compy cube":"c v 0.915641442663986",helicopter:"c e 0.707106781186547","curvy copter":"c e 0.83",dino:"c v 0.577350269189626","little chop":"c e 0",pyramorphix:"t e 0",mastermorphix:"t e 0.346184634065199",pyraminx:"t v 0.333333333333333 v 1.66666666666667","master pyraminx":"t v 0 v 1 v 2","professor pyraminx":"t v -0.2 v 0.6 v 1.4 v 2.2","Jing pyraminx":"t f 0","master pyramorphix":"t e 0.866025403784437",megaminx:"d f 0.7",gigaminx:"d f 0.64 f 0.82",teraminx:"d f 0.64 f 0.76 f 0.88",petaminx:"d f 0.64 f 0.73 f 0.82 f 0.91",examinx:"d f 0.64 f 0.712 f 0.784 f 0.856 f 0.928",zetaminx:"d f 0.64 f 0.7 f 0.76 f 0.82 f 0.88 f 0.94",yottaminx:"d f 0.64 f 0.6914 f 0.7429 f 0.7943 f 0.8457 f 0.8971 f 0.9486",pentultimate:"d f 0","master pentultimate":"d f 0.1",starminx:"d v 0.937962370425399","starminx 2":"d f 0.23606797749979","pyraminx crystal":"d f 0.447213595499989",chopasaurus:"d v 0","big chop":"d e 0","skewb diamond":"o f 0",FTO:"o f 0.333333333333333","Christopher's jewel":"o v 0.577350269189626",octastar:"o e 0","Trajber's octahedron":"o v 0.433012701892219","radio chop":"i f 0",icosamate:"i v 0","icosahedron 2":"i v 0.18759247376021","icosahedron 3":"i v 0.18759247376021 e 0","icosahedron static faces":"i v 0.84","icosahedron moving faces":"i v 0.73","Eitan's star":"i f 0.61803398874989","2x2x2 + dino":"c f 0 v 0.577350269189626","2x2x2 + little chop":"c f 0 e 0","dino + little chop":"c v 0.577350269189626 e 0","2x2x2 + dino + little chop":"c f 0 v 0.577350269189626 e 0","megaminx + chopasaurus":"d f 0.61803398875 v 0","starminx combo":"d f 0.23606797749979 v 0.937962370425399"},E=1e-9;function C(e){for(var t=new U(0,0,0,0),r=0;r<e.length;r++)t=t.sum(e[r]);return t.smul(1/e.length)}function N(e,t,r,i){var n=i[e].intersect3(i[t],i[r]);if(!n)return n;for(var s=0;s<i.length;s++)if(s!==e&&s!==t&&s!==r){var a=i[s].b*n.b+i[s].c*n.c+i[s].d*n.d;if(i[s].a>0&&a>i[s].a||i[s].a<0&&a<i[s].a)return!1}return n}var P=function(){function e(t,r,i){Object(o.a)(this,e),this.face=t,this.left=r,this.right=i}return Object(h.a)(e,[{key:"split",value:function(t){var r,i,n=t.cutface(this.face);return null!==n&&(void 0===this.left?(this.left=new e(n[0]),this.right=new e(n[1])):(this.left=null==(r=this.left)?void 0:r.split(t),this.right=null==(i=this.right)?void 0:i.split(t))),this}},{key:"collect",value:function(e,t){var r,i,n,s;return void 0===this.left?e.push(this.face):t?(null==(r=this.left)||r.collect(e,!1),null==(i=this.right)||i.collect(e,!0)):(null==(n=this.right)||n.collect(e,!1),null==(s=this.left)||s.collect(e,!0)),e}}]),e}(),U=function(){function e(t,r,i,n){Object(o.a)(this,e),this.a=t,this.b=r,this.c=i,this.d=n}return Object(h.a)(e,[{key:"mul",value:function(t){return new e(this.a*t.a-this.b*t.b-this.c*t.c-this.d*t.d,this.a*t.b+this.b*t.a+this.c*t.d-this.d*t.c,this.a*t.c-this.b*t.d+this.c*t.a+this.d*t.b,this.a*t.d+this.b*t.c-this.c*t.b+this.d*t.a)}},{key:"toString",value:function(){return"Q["+this.a+","+this.b+","+this.c+","+this.d+"]"}},{key:"dist",value:function(e){return Math.hypot(this.a-e.a,this.b-e.b,this.c-e.c,this.d-e.d)}},{key:"len",value:function(){return Math.hypot(this.a,this.b,this.c,this.d)}},{key:"cross",value:function(t){return new e(0,this.c*t.d-this.d*t.c,this.d*t.b-this.b*t.d,this.b*t.c-this.c*t.b)}},{key:"dot",value:function(e){return this.b*e.b+this.c*e.c+this.d*e.d}},{key:"normalize",value:function(){var t=Math.sqrt(this.dot(this));return new e(this.a/t,this.b/t,this.c/t,this.d/t)}},{key:"makenormal",value:function(){return new e(0,this.b,this.c,this.d).normalize()}},{key:"normalizeplane",value:function(){var t=Math.hypot(this.b,this.c,this.d);return new e(this.a/t,this.b/t,this.c/t,this.d/t)}},{key:"smul",value:function(t){return new e(this.a*t,this.b*t,this.c*t,this.d*t)}},{key:"sum",value:function(t){return new e(this.a+t.a,this.b+t.b,this.c+t.c,this.d+t.d)}},{key:"sub",value:function(t){return new e(this.a-t.a,this.b-t.b,this.c-t.c,this.d-t.d)}},{key:"angle",value:function(){return 2*Math.acos(this.a)}},{key:"invrot",value:function(){return new e(this.a,-this.b,-this.c,-this.d)}},{key:"det3x3",value:function(e,t,r,i,n,s,a,o,h){return e*(n*h-s*o)+t*(s*a-i*h)+r*(i*o-n*a)}},{key:"rotateplane",value:function(t){var r=t.mul(new e(0,this.b,this.c,this.d)).mul(t.invrot());return r.a=this.a,r}},{key:"orthogonal",value:function(){var t=Math.abs(this.b),r=Math.abs(this.c),i=Math.abs(this.d);return t<r&&t<i?this.cross(new e(0,1,0,0)).normalize():r<t&&r<i?this.cross(new e(0,0,1,0)).normalize():this.cross(new e(0,0,0,1)).normalize()}},{key:"pointrotation",value:function(t){var r=this.normalize();if(t=t.normalize(),r.sub(t).len()<E)return new e(1,0,0,0);var i=r.sum(t);i=i.len()<E?i.orthogonal():i.normalize();var n=r.cross(i);return n.a=r.dot(i),n}},{key:"unproject",value:function(e){return this.sum(e.smul(-this.dot(e)/(this.len()*e.len())))}},{key:"rotatepoint",value:function(e){return e.mul(this).mul(e.invrot())}},{key:"rotateface",value:function(e){var t=this;return e.map((function(e){return e.rotatepoint(t)}))}},{key:"rotatecubie",value:function(e){var t=this;return e.map((function(e){return t.rotateface(e)}))}},{key:"intersect3",value:function(t,r){var i=this.det3x3(this.b,this.c,this.d,t.b,t.c,t.d,r.b,r.c,r.d);return!(Math.abs(i)<E)&&new e(0,this.det3x3(this.a,this.c,this.d,t.a,t.c,t.d,r.a,r.c,r.d)/i,this.det3x3(this.b,this.a,this.d,t.b,t.a,t.d,r.b,r.a,r.d)/i,this.det3x3(this.b,this.c,this.a,t.b,t.c,t.a,r.b,r.c,r.a)/i)}},{key:"side",value:function(e){return e>E?1:e<-E?-1:0}},{key:"cutface",value:function(e){for(var t=this,r=this.a,i=0,n=null,s=0;s<e.length;s++)i|=1<<this.side(e[s].dot(this)-r)+1;if(5===(5&i)){n=[];for(var a=e.map((function(e){return t.side(e.dot(t)-r)})),o=-1;o<=1;o+=2){for(var h=[],f=0;f<e.length;f++){a[f]!==o&&0!==a[f]||h.push(e[f]);var u=(f+1)%e.length;if(a[f]+a[u]===0&&0!==a[f]){var l=e[f].dot(this)-r,c=l/(l-(e[u].dot(this)-r)),v=e[f].smul(1-c).sum(e[u].smul(c));h.push(v)}}n.push(h)}}return n}},{key:"cutfaces",value:function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r],n=this.cutface(i);n?(t.push(n[0]),t.push(n[1])):t.push(i)}return t}},{key:"faceside",value:function(e){for(var t=this.a,r=0;r<e.length;r++){var i=this.side(e[r].dot(this)-t);if(0!==i)return i}throw new Error("Could not determine side of plane in faceside")}},{key:"sameplane",value:function(e){var t=this.normalize(),r=e.normalize();return t.dist(r)<E||t.dist(r.smul(-1))<E}},{key:"makecut",value:function(t){return new e(t,this.b,this.c,this.d)}}]),e}(),T=1e-9;function S(e,t){for(var r=[],i=[],n=0;n<t.length;n++){for(var s=e.rotateplane(t[n]),a=!1,o=0;o<r.length;o++)if(s.dist(r[o])<T){a=!0;break}a||(r.push(s),i.push(t[n]))}return i}function I(e){for(var t=[],r=1;r<e.length;r++)for(var i=r+1;i<e.length;i++){var n=N(0,r,i,e);if(n){for(var s=!1,a=0;a<t.length;a++)if(n.dist(t[a])<T){s=!0;break}s||t.push(n)}}for(;;){for(var o=!1,h=0;h<t.length;h++){var f=(h+1)%t.length;if(e[0].dot(t[h].cross(t[f]))<0){var u=t[h];t[h]=t[f],t[f]=u,o=!0}}if(!o)break}return t}var K=!0;function q(e){K=e}var G=1e-9;function _(e,t){for(var r=0;r<e.length;r++)if(e[r][0].dist(t)<G)return r;throw new Error("Element not found")}function W(){return D}function J(e){return D[e]}function V(e){var t=e.split(/ /).filter(Boolean);if(t.length%2===0)return!1;if("o"!==t[0]&&"c"!==t[0]&&"i"!==t[0]&&"d"!==t[0]&&"t"!==t[0])return!1;for(var r=[],i=1;i<t.length;i+=2){if("f"!==t[i]&&"v"!==t[i]&&"e"!==t[i])return!1;r.push([t[i],t[i+1]])}return[t[0],r]}function Q(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=V(e),i=Object(n.a)(r,2),s=i[0],a=i[1],o=new te(s,a,["allmoves","true"].concat(t));return o.allstickers(),o.genperms(),o}function H(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Q(D[e],t)}function Z(e,t,r){var i=!1;r-t[1]<t[0]&&(e=[e[2],e[3],e[0],e[1]],t=[r-t[1],r-t[0]],i=!0);var n=e[0],s="";if(0===t[0]&&t[1]===r)n+="v";else if(t[0]===t[1])t[1]>0&&(s=String(t[1]+1));else{if(0!==t[0])throw"We only support slice and outer block moves right now. "+t;n=n.toLowerCase(),t[1]>1&&(s=String(t[1]+1))}return[s+n,i]}function $(e,t){for(var r=[],i=0;i<e.length;){i>0&&i<e.length&&"_"===e[i]&&i++;for(var n="",s=0;s<t.length;s++)e.substr(i).startsWith(t[s][1])&&t[s][1].length>n.length&&(n=t[s][1]);if(""===n)throw new Error("Could not split "+e+" into face names.");r.push(n),i+=n.length}return r}function X(e,t){return[e.b/t,-e.c/t,e.d/t]}function Y(e,t){for(var r=[],i=e.length,n=0;n<i;n++)r[i-n-1]=X(e[n],t);return r}function ee(e,t){for(var r=[],i=1;i<10;i++){for(var n=0;n<e.length;n++){var s=(n+e.length-1)%e.length,a=(n+1)%e.length,o=e[s].sub(e[n]).normalize(),h=e[a].sub(e[n]).normalize(),f=o.dot(h),u=t/Math.sqrt(1-f*f);r[n]=e[n].sum(o.sum(h).smul(u))}for(var l=!0,c=0;l&&c<r.length;c++){var v=(c+e.length-1)%e.length,m=(c+1)%e.length;r[v].sub(r[c]).cross(r[m].sub(r[c])).dot(r[c])>=0&&(l=!1)}if(l)return r;t/=2}return e}var te=function(){function e(t,r,i){function n(e){return"string"===typeof e?JSON.parse(e):e}function s(e){return"string"===typeof e?"false"!==e:!!e}if(Object(o.a)(this,e),this.args="",this.cmovesbyslice=[],this.verbose=0,this.allmoves=!1,this.cornersets=!0,this.centersets=!0,this.edgesets=!0,this.graycorners=!1,this.graycenters=!1,this.grayedges=!1,this.killorientation=!1,this.optimize=!1,this.scramble=0,this.fixPiece="",this.orientCenters=!1,this.duplicatedFaces=[],this.duplicatedCubies=[],this.fixedCubie=-1,this.net=[],this.colors=[],this.faceorder=[],this.faceprecedence=[],this.notationMapper=new x,this.addNotationMapper="",this.setReidOrder=!1,void 0!==i){if(i.length%2!==0)throw new Error("Odd length in option list?");for(var a=0;a<i.length;a+=2)if("verbose"===i[a])this.verbose++;else if("quiet"===i[a])this.verbose=0;else if("allmoves"===i[a])this.allmoves=s(i[a+1]);else if("outerblockmoves"===i[a])this.outerblockmoves=s(i[a+1]);else if("vertexmoves"===i[a])this.vertexmoves=s(i[a+1]);else if("rotations"===i[a])this.addrotations=s(i[a+1]);else if("cornersets"===i[a])this.cornersets=s(i[a+1]);else if("centersets"===i[a])this.centersets=s(i[a+1]);else if("edgesets"===i[a])this.edgesets=s(i[a+1]);else if("graycorners"===i[a])this.graycorners=s(i[a+1]);else if("graycenters"===i[a])this.graycenters=s(i[a+1]);else if("grayedges"===i[a])this.grayedges=s(i[a+1]);else if("movelist"===i[a])this.movelist=n(i[a+1]);else if("killorientation"===i[a])this.killorientation=s(i[a+1]);else if("optimize"===i[a])this.optimize=s(i[a+1]);else if("scramble"===i[a])this.scramble=i[a+1];else if("fix"===i[a])this.fixPiece=i[a+1];else if("orientcenters"===i[a])this.orientCenters=s(i[a+1]);else if("puzzleorientation"===i[a])this.puzzleOrientation=n(i[a+1]);else{if("puzzleorientations"!==i[a])throw new Error("Bad option while processing option list "+i[a]);this.puzzleOrientations=n(i[a+1])}}this.args=t+" "+r.map((function(e){return e.join(" ")})).join(" "),i&&(this.args+=" "+i.join(" ")),this.verbose>0&&console.log(this.header("# ")),this.create(t,r)}return Object(h.a)(e,[{key:"create",value:function(e,t){this.moveplanes=[],this.moveplanes2=[],this.faces=[],this.cubies=[];var r=null;switch(e){case"c":r=function(){var e=Math.sqrt(.5);return[new U(e,e,0,0),new U(e,0,e,0)]}();break;case"o":r=function(){var e=Math.sqrt(.5);return[new U(.5,.5,.5,.5),new U(e,0,0,e)]}();break;case"i":r=function(){var e=1/6+Math.sqrt(5)/6,t=2/3+Math.sqrt(5)/3,r=Math.sqrt(e*e+t*t);e/=r,t/=r;var i=2*Math.PI/6;return[new U(Math.cos(i),e*Math.sin(i),t*Math.sin(i),0),new U(Math.cos(i),-e*Math.sin(i),t*Math.sin(i),0)]}();break;case"t":r=[new U(.5,.5,.5,.5),new U(.5,.5,.5,-.5)];break;case"d":r=function(){var e=2*Math.PI/10,t=.5+.3*Math.sqrt(5),r=.5+.1*Math.sqrt(5),i=Math.sqrt(t*t+r*r);return t/=i,r/=i,[new U(Math.cos(e),t*Math.sin(e),r*Math.sin(e),0),new U(.5,.5,.5,.5)]}();break;default:throw new Error("Bad shape argument: "+e)}this.rotations=function(e){for(var t=[new U(1,0,0,0)],r=0;r<t.length;r++)for(var i=0;i<e.length;i++){for(var n=e[i].mul(t[r]),s=n.smul(-1),a=!1,o=0;o<t.length;o++)if(n.dist(t[o])<T||s.dist(t[o])<T){a=!0;break}a||t.push(n)}return t}(r),this.verbose&&console.log("# Rotations: "+this.rotations.length);var i=r[0];this.baseplanerot=S(i,this.rotations);var n=this.baseplanerot.map((function(e){return i.rotateplane(e)}));this.baseplanes=n,this.basefacecount=n.length;var s={4:[["F","D","L","R"]],6:[["F","D","L","U","R"],["R","F","","B",""]],8:[["F","D","L","R"],["D","F","BR",""],["BR","D","","BB"],["BB","BR","U","BL"]],12:[["U","F","","","",""],["F","U","R","C","A","L"],["R","F","","","E",""],["E","R","","BF","",""],["BF","E","BR","BL","I","D"]],20:[["R","C","F","E"],["F","R","L","U"],["L","F","A",""],["E","R","G","I"],["I","E","S","H"],["S","I","J","B"],["B","S","K","D"],["K","B","M","O"],["O","K","P","N"],["P","O","Q",""]]}[n.length];this.net=s,this.colors={4:{F:"#00ff00",D:"#ffff00",L:"#ff0000",R:"#0000ff"},6:{U:"#ffffff",F:"#00ff00",R:"#ff0000",D:"#ffff00",B:"#0000ff",L:"#ff8000"},8:{U:"#ffffff",F:"#ff0000",R:"#00bb00",D:"#ffff00",BB:"#1122ff",L:"#9524c5",BL:"#ff8800",BR:"#aaaaaa"},12:{U:"#ffffff",F:"#006633",R:"#ff0000",C:"#ffffd0",A:"#3399ff",L:"#660099",E:"#ff66cc",BF:"#99ff00",BR:"#0000ff",BL:"#ffff00",I:"#ff6633",D:"#999999"},20:{R:"#db69f0",C:"#178fde",F:"#23238b",E:"#9cc726",L:"#2c212d",U:"#177fa7",A:"#e0de7f",G:"#2b57c0",I:"#41126b",S:"#4b8c28",H:"#7c098d",J:"#7fe7b4",B:"#85fb74",K:"#3f4bc3",D:"#0ff555",M:"#f1c2c8",O:"#58d340",P:"#c514f2",N:"#14494e",Q:"#8b1be1"}}[n.length],this.faceorder={4:["F","D","L","R"],6:["U","D","F","B","L","R"],8:["F","BB","D","U","BR","L","R","BL"],12:["L","E","F","BF","R","I","U","D","BR","A","BL","C"],20:["L","S","E","O","F","B","I","P","R","K","U","D","J","A","Q","H","G","N","M","C"]}[n.length],this.verbose&&console.log("# Base planes: "+n.length);var a=I(n),o=new U(0,0,0,0);this.verbose&&console.log("# Face vertices: "+a.length);var h=n[0].makenormal(),f=a[0].sum(a[1]).makenormal(),u=a[0].makenormal(),l=new U(1,h.b,h.c,h.d);this.verbose&&console.log("# Boundary is "+l);var c=[I(S(l,this.rotations).map((function(e){return l.rotateplane(e)})))];this.edgedistance=c[0][0].sum(c[0][1]).smul(.5).dist(o),this.vertexdistance=c[0][0].dist(o);for(var v=[],m=[],p=!1,g=!1,d=!1,b=0;b<t.length;b++){var y=null,w=0;switch(t[b][0]){case"f":y=h,w=1,p=!0;break;case"v":y=u,w=this.vertexdistance,d=!0;break;case"e":y=f,w=this.edgedistance,g=!0;break;default:throw new Error("Bad cut argument: "+t[b][0])}v.push(y.makecut(Number(t[b][1]))),m.push(t[b][1]<w)}this.addrotations&&(p||v.push(h.makecut(10)),d||v.push(u.makecut(10)),g||v.push(f.makecut(10))),this.basefaces=[];for(var k=0;k<this.baseplanerot.length;k++){var L=this.baseplanerot[k].rotateface(c[0]);this.basefaces.push(L)}var x=[],M=[],F=[],B=[],R=c[0].length;function O(e,t,r){for(var i=0;i<e.length;i++)if(e[i][0].dist(t)<G)return void e[i].push(r);e.push([t,r])}for(var j=0;j<this.baseplanerot.length;j++)for(var D=this.baseplanerot[j].rotateface(c[0]),E=0;E<D.length;E++){var C=(E+1)%D.length;O(B,D[E].sum(D[C]).smul(.5),j)}for(var N=[],q=0;q<this.baseplanerot.length;q++){for(var W=this.baseplanerot[q].rotateface(c[0]),J=[],V=0;V<W.length;V++){var Q=(V+1)%W.length,H=B[_(B,W[V].sum(W[Q]).smul(.5))];if(q===H[1])J.push(H[2]);else{if(q!==H[2])throw new Error("Could not find edge");J.push(H[1])}}N.push(J)}var Z={},$=[];$.push(s[0][0]),Z[s[0][0]]=0,$[N[0][0]]=s[0][1],Z[s[0][1]]=N[0][0];for(var X=0;X<s.length;X++){var Y=Z[s[X][0]];if(void 0===Y)throw new Error("Bad edge description; first edge not connected");for(var ee=-1,te=0;te<N[Y].length;te++){var re=$[N[Y][te]];if(void 0!==re&&re===s[X][1]){ee=te;break}}if(ee<0)throw new Error("First element of a net not known");for(var ie=2;ie<s[X].length;ie++)if(""!==s[X][ie]){var ne=N[Y][(ie+ee-1)%R],se=$[ne];if(void 0!==se&&se!==s[X][ie])throw new Error("Face mismatch in net");$[ne]=s[X][ie],Z[s[X][ie]]=ne}}for(var ae=0;ae<$.length;ae++){for(var oe=!1,he=0;he<this.faceorder.length;he++)if($[ae]===this.faceorder[he]){this.faceprecedence[ae]=he,oe=!0;break}if(!oe)throw new Error("Could not find face "+$[ae]+" in face order list "+this.faceorder)}for(var fe=0;fe<this.baseplanerot.length;fe++){var ue=this.baseplanerot[fe].rotateface(c[0]),le=l.rotateplane(this.baseplanerot[fe]),ce=$[fe];x.push([ue,ce]),M.push([le,ce])}for(var ve=0;ve<this.baseplanerot.length;ve++)for(var me=this.baseplanerot[ve].rotateface(c[0]),pe=$[ve],ge=0;ge<me.length;ge++){var de=(ge+1)%me.length,be=me[ge].sum(me[de]).smul(.5),ye=(ge+2)%me.length,we=me[de].sum(me[ye]).smul(.5),ke=_(B,be),Le=_(B,we);O(F,me[de],[pe,Le,ke])}this.swizzler=new z(x.map((function(e){return e[1]})));for(var ze=this.swizzler.prefixFree?"":"_",xe=0;xe<B.length;xe++){if(3!==B[xe].length)throw new Error("Bad length in edge names "+B[xe]);var Me=$[B[xe][1]],Fe=$[B[xe][2]];Me=this.faceprecedence[B[xe][1]]<this.faceprecedence[B[xe][2]]?Me+ze+Fe:Fe+ze+Me,B[xe]=[B[xe][0],Me]}this.cornerfaces=F[0].length-1;for(var Ae=0;Ae<F.length;Ae++){if(F[Ae].length<4)throw new Error("Bad length in vertex names");for(var Be=1,Re=2;Re<F[Ae].length;Re++)this.faceprecedence[Z[F[Ae][Re][0]]]<this.faceprecedence[Z[F[Ae][Be][0]]]&&(Be=Re);for(var Oe="",je=1;je<F[Ae].length;je++){Oe=1===je?F[Ae][Be][0]:Oe+ze+F[Ae][Be][0];for(var De=1;De<F[Ae].length;De++)if(F[Ae][Be][1]===F[Ae][De][2]){Be=De;break}}F[Ae]=[F[Ae][0],Oe]}this.verbose>1&&(console.log("# Face precedence list: "+this.faceorder.join(" ")),console.log("# Face names: "+x.map((function(e){return e[1]})).join(" ")),console.log("# Edge names: "+B.map((function(e){return e[1]})).join(" ")),console.log("# Vertex names: "+F.map((function(e){return e[1]})).join(" ")));for(var Ee=[],Ce=0;Ce<M.length;Ce++)Ee.push([M[Ce][0].makenormal(),M[Ce][1],"f"]);for(var Ne=0;Ne<B.length;Ne++)Ee.push([B[Ne][0].makenormal(),B[Ne][1],"e"]);for(var Pe=0;Pe<F.length;Pe++)Ee.push([F[Pe][0].makenormal(),F[Pe][1],"v"]);this.facenames=x,this.faceplanes=M,this.edgenames=B,this.vertexnames=F,this.geonormals=Ee;var Ue=Ee.map((function(e){return e[1]}));this.swizzler.setGripNames(Ue),this.verbose&&console.log("# Distances: face 1 edge "+this.edgedistance+" vertex "+this.vertexdistance);for(var Te=0;Te<v.length;Te++)for(var Se=0;Se<this.rotations.length;Se++){for(var Ie=v[Te].rotateplane(this.rotations[Se]),Ke=!1,qe=0;qe<this.moveplanes.length;qe++)if(Ie.sameplane(this.moveplanes[qe])){Ke=!0;break}Ke||(this.moveplanes.push(Ie),m[Te]&&this.moveplanes2.push(Ie))}for(var Ge=new P(c[0]),_e=this.moveplanes2.slice(),We=31,Je=0;Je<_e.length;Je++){var Ve=Je+Math.floor((_e.length-Je)*(We/65536));Ge=Ge.split(_e[Ve]),_e[Ve]=_e[Je],We=(1657*We+101)%65536}c=Ge.collect([],!0),this.faces=c,this.verbose&&console.log("# Faces is now "+c.length),this.stickersperface=c.length;for(var Qe=1e99,He=0;He<c.length;He++)for(var Ze=0;Ze<c[He].length;Ze++){var $e=(Ze+1)%c[He].length,Xe=c[He][Ze].dist(c[He][$e]);Xe<Qe&&(Qe=Xe)}this.shortedge=Qe,this.verbose&&console.log("# Short edge is "+Qe),"c"!==e||!p||g||d||(this.addNotationMapper="NxNxNCubeMapper",this.setReidOrder=!0),"c"!==e||!d||p||g||(this.addNotationMapper="SkewbMapper"),"t"!==e||!d&&!p||g||(this.addNotationMapper="PyraminxMapper"),"o"===e&&p&&K&&(this.notationMapper=new A(this.swizzler,new z(["F","D","L","BL","R","U","BR","B"])),g||d||(this.addNotationMapper="FTOMapper")),"d"===e&&p&&K&&(this.addNotationMapper="MegaminxMapper",this.notationMapper=new A(this.swizzler,new z(["U","F","L","BL","BR","R","FR","FL","DL","B","DR","D"])))}},{key:"keyface",value:function(e){return this.keyface2(C(e))}},{key:"keyface2",value:function(e){for(var t="",r=0;r<this.moveplanesets.length;r++)if(this.moveplanesets[r].length>0){for(var i=e.dot(this.moveplanesets[r][0]),n=0,s=1;2*s<=this.moveplanesets[r].length;)s*=2;for(;s>0;s>>=1)n+s<=this.moveplanesets[r].length&&i>this.moveplanesets[r][n+s-1].a&&(n+=s);t=t+" "+n}return t}},{key:"findface",value:function(e){var t=C(e),r=this.keyface2(t),i=this.facelisthash[r];if(1===i.length)return i[0];for(var n=0;n+1<i.length;n++){var s=this.facelisthash[r][n];if(Math.abs(t.dist(this.facecentermass[s]))<G)return s}return i[i.length-1]}},{key:"findface2",value:function(e){var t=this.keyface2(e),r=this.facelisthash[t];if(1===r.length)return r[0];for(var i=0;i+1<r.length;i++){var n=this.facelisthash[t][i];if(Math.abs(e.dist(this.facecentermass[n]))<G)return n}return r[r.length-1]}},{key:"project2d",value:function(e,t,r){var i=this.facenames[e][0],n=(t+1)%i.length,s=this.baseplanes[e],a=i[n].sub(i[t]),o=a.len(),h=(a=a.normalize()).cross(s).normalize(),f=r[1].sub(r[0]),u=f.len()/o,l=(f=f.normalize()).b,c=f.c,v=a.smul(l).sub(h.smul(c)).smul(u),m=h.smul(l).sum(a.smul(c)).smul(u),p=new U(0,r[0].b-v.dot(i[t]),r[0].c-m.dot(i[t]),0);return[v,m,p]}},{key:"allstickers",value:function(){var e=this;this.faces=function(e,t){for(var r=[],i=0;i<e.length;i++)for(var n=0;n<t.length;n++){for(var s=t[n],a=[],o=0;o<s.length;o++)a.push(s[o].rotateplane(e[i]));r.push(a)}return r}(this.baseplanerot,this.faces),this.verbose&&console.log("# Total stickers is now "+this.faces.length),this.facecentermass=new Array(this.faces.length);for(var t=0;t<this.faces.length;t++)this.facecentermass[t]=C(this.faces[t]);for(var r=[],i=[],n=0;n<this.moveplanes.length;n++){for(var s=this.moveplanes[n].makenormal(),a=!1,o=0;o<i.length;o++)s.sameplane(i[o].makenormal())&&(a=!0);a||(i.push(s),r.push([]))}for(var h=0;h<this.moveplanes2.length;h++)for(var f=this.moveplanes2[h],u=f.makenormal(),l=0;l<i.length;l++)if(u.sameplane(i[l])){r[l].push(f);break}for(var c=0;c<r.length;c++){for(var v=r[c].map((function(e){return e.normalizeplane()})),m=i[c],p=0;p<v.length;p++)v[p].makenormal().dist(m)>G&&(v[p]=v[p].smul(-1));v.sort((function(e,t){return e.a-t.a})),r[c]=v}this.moveplanesets=r,this.moveplanenormals=i;var g=r.map((function(e){return e.length}));this.verbose&&console.log("# Move plane sets: "+g);for(var d=[],b=0;b<r.length;b++)d.push([]);for(var y=0;y<this.rotations.length;y++){var w=this.rotations[y];if(!(Math.abs(Math.abs(w.a)-1)<G))for(var k=w.makenormal(),L=0;L<r.length;L++)if(k.sameplane(i[L])){d[L].push(w);break}}this.moverotations=d;for(var z=0;z<d.length;z++){for(var x=d[z],M=x[0].makenormal(),A=0;A<x.length;A++)M.dist(x[A].makenormal())>G&&(x[A]=x[A].smul(-1));x.sort((function(e,t){return e.angle()-t.angle()})),d[z][0].dot(i[z])<0&&x.reverse()}var D=d.map((function(e){return 1+e.length}));this.movesetorders=D;for(var E=[],N="?",P=0;P<r.length;P++){for(var U=i[P],T=null,S=null,I=0;I<this.geonormals.length;I++){var K=U.dot(this.geonormals[I][0]);Math.abs(K-1)<G?(S=[this.geonormals[I][1],this.geonormals[I][2]],N=this.geonormals[I][2]):Math.abs(K+1)<G&&(T=[this.geonormals[I][1],this.geonormals[I][2]],N=this.geonormals[I][2])}if(null===S||null===T)throw new Error("Saw positive or negative sides as null");E.push([S[0],S[1],T[0],T[1],1+r[P].length]),"NxNxNCubeMapper"===this.addNotationMapper&&"f"===N&&(this.notationMapper=new F(1+r[P].length),this.addNotationMapper=""),"SkewbMapper---DISABLED"===this.addNotationMapper&&1===r[0].length&&(this.notationMapper=new R(this.swizzler),this.addNotationMapper=""),"PyraminxMapper---DISABLED"===this.addNotationMapper&&2===r[0].length&&(this.notationMapper=new O(this.swizzler),this.addNotationMapper=""),"MegaminxMapper"===this.addNotationMapper&&"f"===N&&(1+r[P].length===3&&(this.notationMapper=new B(this.notationMapper)),this.addNotationMapper=""),"FTOMapper"===this.addNotationMapper&&"f"===N&&(1+r[P].length===3&&(this.notationMapper=new j(this.notationMapper,this.swizzler)),this.addNotationMapper="")}this.movesetgeos=E;for(var q={},_={},W={},J=[],V=[],Q=this.faces,H=0;H<Q.length;H++){var Z=Q[H],$=this.keyface(Z);if(q[$]||(W[$]=V.length,J.push($),q[$]=[],_[$]=[],V.push(q[$])),_[$].push(H),q[$].push(Z),_[$].length===this.basefacecount){this.verbose&&console.log("# Splitting core.");for(var X=0;X<this.basefacecount;X++){var Y=$+" "+X;_[Y]=[_[$][X]],q[Y]=[q[$][X]],J.push(Y),W[Y]=V.length,V.push(q[Y])}q[$]=[],V[W[$]]=[]}}this.cubiekey=W,this.facelisthash=_,this.cubiekeys=J,this.verbose&&console.log("# Cubies: "+Object.keys(q).length),this.cubies=V;for(var ee=0;ee<V.length;ee++){var te=V[ee];if(!(te.length<2)&&te.length!==this.basefacecount){if(te.length>5)throw new Error("Bad math; too many faces on this cubie "+te.length);for(var re=te.map((function(e){return C(e)})),ie=_[this.keyface2(re[0])],ne=C(re),se=0;te.length>2;se++){for(var ae=!1,oe=0;oe<te.length;oe++){var he=(oe+1)%te.length;if(ne.dot(re[oe].cross(re[he]))<0){var fe=te[oe];te[oe]=te[he],te[he]=fe;var ue=re[oe];re[oe]=re[he],re[he]=ue;var le=ie[oe];ie[oe]=ie[he],ie[he]=le,ae=!0}}if(!ae)break;if(se>1e3)throw new Error("Bad epsilon math; too close to border")}for(var ce=0,ve=this.findface(te[ce]),me=1;me<te.length;me++){var pe=this.findface(te[me]);this.faceprecedence[this.getfaceindex(pe)]<this.faceprecedence[this.getfaceindex(ve)]&&(ce=me,ve=pe)}if(0!==ce)for(var ge=te.slice(),de=ie.slice(),be=0;be<te.length;be++)te[be]=ge[(ce+be)%te.length],ie[be]=de[(ce+be)%te.length]}}for(var ye=[],we=0;we<V.length;we++)for(var ke=_[J[we]],Le=0;Le<ke.length;Le++)ye[ke[Le]]=[we,Le];this.facetocubies=ye;for(var ze=["?","CENTERS","EDGES","CORNERS","C4RNER","C5RNER"],xe=[],Me=[0,0,0,0,0,0],Fe=[],Ae=[],Be=0,Re=[],Oe=[],je=[],De=[],Ee=function(t){return V[t].map((function(t){return e.getfaceindex(e.findface(t))})).join(" ")},Ce=[],Ne=0;Ne<V.length;Ne++)if(!Ae[Ne]){var Pe=V[Ne];if(0!==Pe.length){var Ue={},Te=0;je.push(0),Ce.push([]);var Se=Pe.length,Ie=Me[Se]++,Ke=ze[Se];void 0!==Ke&&Se!==this.basefacecount||(Ke="CORE"),Ke+=0===Ie?"":Ie+1,xe[Be]=Ke,Fe[Be]=Se;var qe=[Ne],Ge=0;for(Ae[Ne]=!0;Ge<qe.length;){var _e=qe[Ge++],We=Ee(_e);(Pe.length>1||void 0===Ue[We])&&(Ue[We]=Te++),De[_e]=Ue[We],Re[_e]=Be,Ce[Be].push(_e),Oe[_e]=je[Be]++;var Je=C(V[_e][0]);if(qe.length<this.rotations.length)for(var Ve=0;Ve<d.length;Ve++){var Qe=this.facetocubies[this.findface2(Je.rotatepoint(d[Ve][0]))][0];Ae[Qe]||(qe.push(Qe),Ae[Qe]=!0)}}Be++}}if(this.setReidOrder&&4<=this.stickersperface&&this.stickersperface<=9){for(var He=[["UF","UR","UB","UL","DF","DR","DB","DL","FR","FL","BR","BL"],["UFR","URB","UBL","ULF","DRF","DFL","DLB","DBR"],["U","L","F","R","B","D"]],Ze={},$e=0;$e<He.length;$e++)for(var Xe=0;Xe<He[$e].length;Xe++){for(var Ye=0,et=0;et<He[$e][Xe].length;et++)Ye|=1<<He[$e][Xe].charCodeAt(et)-65;Ze[Ye]=Xe}for(var tt=0;tt<Be;tt++)for(var rt=0;rt<Ce[tt].length;rt++){for(var it=Ce[tt][rt],nt=0,st=0;st<V[it].length;st++)nt|=1<<this.facenames[this.getfaceindex(this.findface(V[it][st]))][1].charCodeAt(0)-65;Oe[it]=Ze[nt]}}if(this.orbits=je.length,this.cubiesetnums=Re,this.cubieordnums=Oe,this.cubiesetnames=xe,this.cubieords=je,this.orbitoris=Fe,this.cubievaluemap=De,this.cubiesetcubies=Ce,""!==this.fixPiece){for(var at=0;at<V.length;at++)if("v"===this.fixPiece&&V[at].length>2||"e"===this.fixPiece&&2===V[at].length||"f"===this.fixPiece&&1===V[at].length){this.fixedCubie=at;break}if(this.fixedCubie<0)throw new Error("Could not find a cubie of type "+this.fixPiece+" to fix.")}this.verbose&&console.log("# Cubie orbit sizes "+je)}},{key:"unswizzle",value:function(e){var t=this.notationMapper.notationToInternal(e);return null===t?"":this.swizzler.unswizzle(t.family)}},{key:"stringToBlockMove",value:function(e){var t=RegExp("^(([0-9]+)-)?([0-9]+)?([^0-9]+)([0-9]+'?)?$"),r=e.match(t);if(null===r)throw new Error("Bad move passed "+e);var i=r[4],n=void 0,s=void 0;if(void 0!==r[2]){if(void 0===r[3])throw new Error("Missing second number in range");n=parseInt(r[2],10)}void 0!==r[3]&&(s=parseInt(r[3],10));var a="1",o=1;return void 0!==r[5]&&("'"===(a=r[5])[0]&&(a="-"+a.substring(1)),o=parseInt(a,10)),new f.f(new f.g(i,s,n),o)}},{key:"parseMove",value:function(e){var t=this.notationMapper.notationToInternal(e);if(null===t)throw new Error("Bad move "+e.family);var r,i=(e=t).family,n=!1;if(i.endsWith("v")&&i[0]<="Z"){if(void 0!==e.innerLayer||void 0!==e.outerLayer)throw new Error("Cannot use a prefix with full cube rotations");i=i.slice(0,-1),n=!0}i.endsWith("w")&&i[0]<="Z"&&(i=i.slice(0,-1).toLowerCase());for(var s=-1,a=this.swizzler.unswizzle(i),o=!1,h=0;h<this.movesetgeos.length;h++){var f=this.movesetgeos[h];a===f[0]&&(o=!0,r=f,s=h),a===f[2]&&(o=!1,r=f,s=h)}var u=1,l=1;if(i.toUpperCase()!==i&&(l=2),void 0===r)throw new Error("Bad grip in move "+e.family);if(void 0!==e.outerLayer&&(u=e.outerLayer),void 0!==e.innerLayer&&(void 0===e.outerLayer?(l=e.innerLayer,u=a===i?l:1):l=e.innerLayer),u--,l--,n&&(u=0,l=this.moveplanesets[s].length),u<0||u>this.moveplanesets[s].length||l<0||l>this.moveplanesets[s].length)throw new Error("Bad slice spec "+u+" "+l);if(0===u&&l===this.moveplanesets[s].length&&!n)throw new Error("! full puzzle rotations must be specified with v suffix.");return[void 0,s,u,l,o,e.effectiveAmount]}},{key:"parsemove",value:function(e){var t=this.parseMove(this.stringToBlockMove(e));return t[0]=e,t}},{key:"genperms",value:function(){if(!(this.cmovesbyslice.length>0)){var e=[];if(this.orientCenters)for(var t=0;t<this.cubies.length;t++)if(1===this.cubies[t].length){var r=this.findface(this.cubies[t][0]),i=this.getfaceindex(r);if(C(this.basefaces[i]).dist(this.facecentermass[r])<G){for(var n=this.basefaces[i].length,s=0;s<n;s++)this.cubies[t].push(this.cubies[t][0]);this.duplicatedFaces[r]=n,this.duplicatedCubies[t]=n,this.orbitoris[this.cubiesetnums[t]]=n}}for(var a=0;a<this.moveplanesets.length;a++){for(var o=this.moveplanesets[a],h=[],f=[o.length+1,0],u=1;2*u<=o.length;)u*=2;for(var l=0;l<this.faces.length;l++){var c=0;if(o.length>0){for(var v=this.facecentermass[l].dot(o[0]),m=u;m>0;m>>=1)c+m<=o.length&&v>o[c+m-1].a&&(c+=m);c=o.length-c}for(h.push(c);f.length<=c;)f.push(0);f[c]++}for(var p=new Array(f.length),g=0;g<f.length;g++)p[g]=[];for(var d=[],b=0;b<this.faces.length;b++)if(!(h[b]<0)){for(var y=this.facetocubies[b].slice(),w=this.facecentermass[b],k=w,L=b,z=h[L];;){h[L]=-1;var x=w.rotatepoint(this.moverotations[a][0]);if(x.dist(k)<G)break;L=this.findface2(x);var M=this.facetocubies[L];y.push(M[0],M[1]),w=x}if(y.length>2&&this.orientCenters&&(1===this.cubies[y[0]].length||this.cubies[y[0]][0]===this.cubies[y[0]][1])&&this.facecentermass[b].dist(C(this.basefaces[this.getfaceindex(b)]))<G)for(var F=this.cubies[y[0]][0],A=0;A<y.length;A+=2){for(var B=this.cubies[y[A]][0],R=-1,O=0;O<F.length;O++)if(B[O].dist(F[0])<G){R=O;break}if(R<0)throw new Error("Couldn't find rotation of center faces; ignoring for now.");y[A+1]=R,F=this.moverotations[a][0].rotateface(F)}if(2===y.length&&this.orientCenters)for(var j=1;j<this.movesetorders[a];j++)0===z?y.push(y[0],j):y.push(y[0],(this.movesetorders[a]-j)%this.movesetorders[a]);if(y.length>2&&!d[y[0]]){if(y.length!==2*this.movesetorders[a])throw new Error("Bad length in perm gen");for(var D=0;D<y.length;D++)p[z].push(y[D])}for(var E=0;E<y.length;E+=2)d[y[E]]=!0}e.push(p)}if(this.cmovesbyslice=e,void 0!==this.movelist){for(var N=[],P=0;P<this.movelist.length;P++)N.push(this.parsemove(this.movelist[P]));this.parsedmovelist=N}this.facelisthash=null,this.facecentermass=[],this.cubiekey=[]}}},{key:"getfaces",value:function(){return this.faces.map((function(e){return e.map((function(e){return[e.b,e.c,e.d]}))}))}},{key:"getboundarygeometry",value:function(){return{baseplanes:this.baseplanes,facenames:this.facenames,faceplanes:this.faceplanes,vertexnames:this.vertexnames,edgenames:this.edgenames,geonormals:this.geonormals}}},{key:"getmovesets",value:function(e){var t=this.moveplanesets[e].length,r=[];if(void 0!==this.parsedmovelist)for(var i=0;i<this.parsedmovelist.length;i++){var n=this.parsedmovelist[i];n[1]===e&&(n[4]?r.push([n[2],n[3]]):r.push([t-n[3],t-n[2]]),r.push(n[5]))}else if(this.vertexmoves&&!this.allmoves){var s=this.movesetgeos[e];if(s[1]!==s[3])for(var a=0;a<t;a++)"v"!==s[1]?(this.outerblockmoves?r.push([a+1,t]):r.push([a+1]),r.push(1)):(this.outerblockmoves?r.push([0,a]):r.push([a,a]),r.push(1))}else for(var o=0;o<=t;o++)(this.allmoves||o+o!==t)&&(this.outerblockmoves?o+o>t?r.push([o,t]):r.push([0,o]):r.push([o,o]),r.push(1));if(this.addrotations&&!this.allmoves&&(r.push([0,t]),r.push(1)),this.fixedCubie>=0){for(var h=+this.cubiekeys[this.fixedCubie].trim().split(" ")[e],f=[],u=0;u<r.length;u+=2){var l=r[u];if(h>=l[0]&&h<=l[1])if(0===l[0])l=[l[1]+1,t];else{if(t!==l[1])throw Error("fixed cubie option would disconnect move");l=[0,l[0]-1]}for(var c=!1,v=0;v<f.length;v+=2)if(f[v][0]===l[0]&&f[v][1]===l[1]&&f[v+1]===r[u+1]){c=!0;break}c||(f.push(l),f.push(r[u+1]))}r=f}return r}},{key:"graybyori",value:function(e){var t=this.cubies[e].length;return this.duplicatedCubies[e]&&(t=1),1===t&&(this.graycenters||!this.centersets)||2===t&&(this.grayedges||!this.edgesets)||t>2&&(this.graycorners||!this.cornersets)}},{key:"skipbyori",value:function(e){var t=this.cubies[e].length;return this.duplicatedCubies[e]&&(t=1),1===t&&!this.centersets||2===t&&!this.edgesets||t>2&&!this.cornersets}},{key:"skipcubie",value:function(e){return this.skipbyori(e)}},{key:"skipset",value:function(e){if(0===e.length)return!0;var t=e[0];return this.skipbyori(this.facetocubies[t][0])}},{key:"header",value:function(e){return e+"PuzzleGeometry 0.1 Copyright 2018 Tomas Rokicki.\n"+e+this.args+"\n"}},{key:"writegap",value:function(){for(var e=this.getOrbitsDef(!1),t=[],r=[],i=0;i<e.moveops.length;i++){var n="M_"+e.movenames[i];r.push(n),t.push(n+":="+e.moveops[i].toPerm().toGap()+";")}t.push("Gen:=["),t.push(r.join(",")),t.push("];");var s=e.solved.identicalPieces();return t.push("ip:=["+s.map((function(e){return"["+e.map((function(e){return e+1})).join(",")+"]"})).join(",")+"];"),t.push(""),this.header("# ")+t.join("\n")}},{key:"writeksolve",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"PuzzleGeometryPuzzle",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.getOrbitsDef(t);return t?r.toKsolve(e,t).join("\n"):this.header("# ")+r.toKsolve(e,t).join("\n")}},{key:"writekpuzzle",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getOrbitsDef(e),r=t.toKpuzzle();return r.moveNotation=new re(this,t),r}},{key:"getMoveFromBits",value:function(e,t,r,i,n,s){for(var a=[],o=[],h=[],f=0;f<this.cubiesetnames.length;f++)o.push(v(this.cubieords[f])),h.push(c(this.cubieords[f]));for(var u=e[0];u<=e[1];u++)for(var l=i[u],m=0;m<l.length;m+=2*s){for(var p=l.slice(m,m+2*s),g=this.cubiesetnums[p[0]],d=0;d<p.length;d+=2)p[d]=this.cubieordnums[p[d]];var y=2,k=3;r&&(y=p.length-2,k=p.length-1),o[g]===v(this.cubieords[g])&&(o[g]=o[g].slice(),this.orbitoris[g]>1&&!this.killorientation&&(h[g]=h[g].slice()));for(var L=0;L<p.length;L+=2)o[g][p[(L+y)%p.length]]=p[L],this.orbitoris[g]>1&&!this.killorientation&&(h[g][p[L]]=(p[(L+k)%p.length]-p[(L+1)%p.length]+2*this.orbitoris[g])%this.orbitoris[g])}for(var z=new b(v(24),c(24),1),x=0;x<this.cubiesetnames.length;x++)if(!n||n[x])if(1===this.orbitoris[x]||this.killorientation)o[x]===v(z.perm.length)?(o[x]!==z.perm&&(z=new b(o[x],h[x],1)),a.push(z)):a.push(new b(o[x],h[x],1));else{for(var M=new Array(h[x].length),F=0;F<o[x].length;F++)M[F]=h[x][o[x][F]];a.push(new b(o[x],M,this.orbitoris[x]))}var A=new w(a);return 1!==t&&(A=A.mulScalar(t)),A}},{key:"getOrbitsDef",value:function(e){for(var t=[],r=[],i=[],n=0;n<this.moveplanesets.length;n++){for(var s=this.getmovesets(n),a=this.movesetorders[n],o=0;o<s.length;o+=2)for(var h=0;h<o;h+=2)if(s[o]===s[h]&&s[o+1]===s[h+1])throw new Error("Redundant moves in moveset.");for(var f=[],u=0;u<s.length;u+=2)for(var l=s[u][0];l<=s[u][1];l++)f[l]=1;for(var c=this.cmovesbyslice[n],v=0;v<c.length;v++)if(1===f[v])for(var m=c[v],p=0;p<m.length;p+=2*a){if(!this.skipcubie(m[p]))t[this.cubiesetnums[m[p]]]=1}}for(var y=0;y<this.cubiesetnames.length;y++)t[y]&&(r.push(this.cubiesetnames[y]),i.push(new g(this.cubieords[y],this.killorientation?1:this.orbitoris[y])));for(var w=[],L=0;L<this.cubiesetnames.length;L++)if(t[L]){for(var z=[],x=[],M=0;M<this.cubieords[L];M++){if(e)z.push(M);else{var F=this.cubiesetcubies[L][M];z.push(this.cubievaluemap[F])}x.push(0)}w.push(new b(z,x,this.killorientation?1:this.orbitoris[L]))}for(var A=[],B=[],R=0;R<this.moveplanesets.length;R++)for(var O=this.moveplanesets[R].length,j=this.getmovesets(R),D=this.movesetgeos[R],E=0;E<j.length;E+=2){var C=j[E],N=Z(D,C,O),P=N[0],U=N[1];1===j[E+1]?A.push(P):A.push(P+j[E+1]);var T=this.getMoveFromBits(C,j[E+1],U,this.cmovesbyslice[R],t,this.movesetorders[R]);B.push(T)}this.ksolvemovenames=A;var S=new d(r,i,new k(w),A,B);return this.optimize&&(S=S.optimize()),0!==this.scramble&&S.scramble(this.scramble),S}},{key:"getMovesAsPerms",value:function(){return this.getOrbitsDef(!1).moveops.map((function(e){return e.toPerm()}))}},{key:"showcanon",value:function(e){!function(e,t){var r=e.moveops.length;if(r>30)throw new Error("Canon info too big for bitmask");for(var i=[],n=[],s=0;s<r;s++){var a=e.moveops[s];i.push(a.order());for(var o=0,h=0;h<r;h++)if(h!==s){var f=e.moveops[h];a.mul(f).equal(f.mul(a))&&(o|=1<<h)}n.push(o)}for(var u={0:1},l=0;l<100;l++){var c=0,v={},m=0;for(var p in u){var g=+p,d=u[g];c+=d,m++;for(var b=0;b<i.length;b++)if(0===(g>>b&1)&&0===(g&n[b]&(1<<b)-1)){var y=g&n[b]|1<<b;void 0===v[y]&&(v[y]=0),v[y]+=(i[b]-1)*d}}t(l+": canonseq "+c+" states "+m),u=v}}(this.getOrbitsDef(!1),e)}},{key:"getsolved",value:function(){for(var e=[],t=0;t<this.basefacecount;t++)for(var r=0;r<this.stickersperface;r++)e.push(t);return new p(e)}},{key:"getOrientationRotation",value:function(e){var t,r=e[0],n=new U(0,e[1][0],-e[1][1],e[1][2]),s=e[2],a=new U(0,e[3][0],-e[3][1],e[3][2]),o=null,h=null,f=this.swizzler.unswizzle(r),u=this.swizzler.unswizzle(s),l=Object(i.a)(this.geonormals);try{for(l.s();!(t=l.n()).done;){var c=t.value;f===c[1]&&(o=c[0]),u===c[1]&&(h=c[0])}}catch(m){l.e(m)}finally{l.f()}if(!o)throw new Error("Could not find feature "+r);if(!h)throw new Error("Could not find feature "+s);var v=o.pointrotation(n);return h.rotatepoint(v).unproject(n).pointrotation(a.unproject(n)).mul(v)}},{key:"getInitial3DRotation",value:function(){var e=this.basefacecount,t=null;if(this.puzzleOrientation?t=this.puzzleOrientation:this.puzzleOrientations&&(t=this.puzzleOrientations[e]),t||(t={4:["FLR",[0,1,0],"F",[0,0,1]],6:["U",[0,1,0],"F",[0,0,1]],8:["U",[0,1,0],"F",[0,0,1]],12:["U",[0,1,0],"F",[0,0,1]],20:["GUQMJ",[0,1,0],"F",[0,0,1]]}[e]),!t)throw new Error("No default orientation?");return this.getOrientationRotation(t)}},{key:"generatesvg",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:800,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];function s(e,t){for(var r=e[1][0]-e[0][0],i=e[1][1]-e[0][1],n=2*Math.PI/t,s=Math.cos(n),a=Math.sin(n),o=2;o<t;o++){var h=r*s+i*a;i=i*s-r*a,r=h,e.push([e[o-1][0]+r,e[o-1][1]+i])}}function a(e){return e+0*(Math.random()-.5)}function o(e,t,r){return'<polygon id="'+e+'" class="sticker" style="fill: '+r+'" points="'+t.map((function(e){return a(e[0])+" "+a(e[1])})).join(" ")+'"/>\n'}t-=2*i,r-=2*i;for(var h=this.addrotations,f=this.addrotations,u=this.addrotations,l=0;l<this.movesetgeos.length;l++)for(var c=this.movesetgeos[l],v=1;v<=3;v+=2)"v"===c[v]&&(h=!0),"f"===c[v]&&(u=!0),"e"===c[v]&&(f=!0);this.genperms();var m=this.getboundarygeometry(),p=m.facenames[0][0],g=p.length,d=this.net;if(null===d)throw new Error("No net?");var b={},y=0,w=0,k=1,L=0;b[d[0][0]]=[[1,0],[0,0]],s(b[d[0][0]],g);for(var z=0;z<d.length;z++){var x=d[z][0];if(!b[x])throw new Error("Bad edge description; first edge not connected.");for(var M=1;M<d[z].length;M++){var F=d[z][M];""===F||b[F]||(b[F]=[b[x][M%g],b[x][(M+g-1)%g]],s(b[F],g))}}for(var A in b)for(var B=b[A],R=0;R<B.length;R++)y=Math.min(y,B[R][0]),k=Math.max(k,B[R][0]),w=Math.min(w,B[R][1]),L=Math.max(L,B[R][1]);var O=Math.min(t/(k-y),r/(L-w)),j=.5*(t-O*(k+y)),D=.5*(r-O*(L+w)),E={},C=this.getboundarygeometry(),N={},P=[[O+j,D],[j,D]];N[d[0][0]]=P,s(N[d[0][0]],g),E[this.facenames[0][1]]=this.project2d(0,0,[new U(0,P[0][0],P[0][1],0),new U(0,P[1][0],P[1][1],0)]);var T=[];T[0]=0;for(var S=0;S<d.length;S++){var I=d[S][0];if(!N[I])throw new Error("Bad edge description; first edge not connected.");for(var K=-1,q=0;q<C.facenames.length;q++)if(I===C.facenames[q][1]){K=q;break}if(K<0)throw new Error("Could not find first face name "+I);for(var W=C.facenames[K][0],J=1;J<d[S].length;J++){var V=d[S][J];if(""!==V&&!N[V]){N[V]=[N[I][J%g],N[I][(J+g-1)%g]],s(N[V],g);for(var Q=T[K],H=W[(Q+J)%g].sum(W[(Q+J+g-1)%g]).smul(.5),Z=_(C.edgenames,H),X=C.edgenames[Z][1],Y=$(X,this.facenames),ee=Y[I===Y[0]?1:0],te=-1,re=0;re<C.facenames.length;re++)if(ee===C.facenames[re][1]){te=re;break}if(te<0)throw new Error("Could not find second face name");for(var ie=C.facenames[te][0],ne=0;ne<ie.length;ne++){var se=ie[ne].sum(ie[(ne+1)%g]).smul(.5);if(se.dist(H)<=G){var ae=N[I][(J+g-1)%g],oe=N[I][J%g];T[te]=ne,E[ee]=this.project2d(te,ne,[new U(0,oe[0],oe[1],0),new U(0,ae[0],ae[1],0)]);break}}}}}for(var he=this.getsolved(),fe=[],ue=[],le=0;le<this.basefacecount;le++)fe[le]=this.colors[this.facenames[le][1]];for(var ce=0,ve=0,me=this.getInitial3DRotation(),pe=0;pe<this.faces.length;pe++){var ge=this.faces[pe];ge=me.rotateface(ge);for(var de=0;de<ge.length;de++)ce=Math.max(ce,Math.abs(ge[de].b)),ve=Math.max(ve,Math.abs(ge[de].c))}for(var be=Math.min(r/ve/2,(t-i)/ce/4),ye=function(s,a){if(n){var o=.5*i+.25*t,h=e.baseplanes[s].rotateplane(me).d<0?1:-1;return[i+.5*t+h*(o-a.b*be),i+.5*r+a.c*be]}var f=E[e.facenames[s][1]];return[i+a.dot(f[0])+f[2].b,i+r-a.dot(f[1])-f[2].c]},we=function(t){var r=e.faces[t],i=Math.floor(t/e.stickersperface);n&&(r=me.rotateface(r)),ue.push(r.map((function(e){return ye(i,e)})))},ke=0;ke<this.faces.length;ke++)we(ke);for(var Le=[],ze=0;ze<this.basefacecount;ze++){Le.push("<g>"),Le.push("<title>"+this.facenames[ze][1]+"</title>\n");for(var xe=0;xe<this.stickersperface;xe++){var Me=ze*this.stickersperface+xe,Fe=this.facetocubies[Me][0],Ae=this.facetocubies[Me][1],Be=this.cubiesetnums[Fe],Re=this.cubieordnums[Fe],Oe=this.graybyori(Fe)?"#808080":fe[he.p[Me]],je=this.cubiesetnames[Be]+"-l"+Re+"-o"+Ae;if(Le.push(o(je,ue[Me],Oe)),this.duplicatedFaces[Me])for(var De=1;De<this.duplicatedFaces[Me];De++)je=this.cubiesetnames[Be]+"-l"+Re+"-o"+De,Le.push(o(je,ue[Me],Oe))}Le.push("</g>")}var Ee=[];function Ce(e,t,r,i){for(var n=ye(e,r),s=0;s<Ee.length;s++)if(Math.hypot(n[0]-Ee[s][0],n[1]-Ee[s][1])<G)return;Ee.push([n[0],n[1],t,i])}for(var Ne=0;Ne<this.faceplanes.length;Ne++){var Pe=this.facenames[Ne][0],Ue=Pe;if(n&&(Ue=me.rotateface(Ue)),u){var Te=this.faceplanes[Ne][0];n&&(Te=Te.rotatepoint(me)),Ce(Ne,this.faceplanes[Ne][1],Te,g)}for(var Se=0;Se<Pe.length;Se++){if(f){var Ie=Pe[Se].sum(Pe[(Se+1)%Pe.length]).smul(.5),Ke=_(this.edgenames,Ie),qe=Ue[Se].sum(Ue[(Se+1)%Pe.length]).smul(.5);Ce(Ne,this.edgenames[Ke][1],qe,2)}if(h){var Ge=_(this.vertexnames,Pe[Se]);Ce(Ne,this.vertexnames[Ge][1],Ue[Se],this.cornerfaces)}}}var _e='<svg id="svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 800 500">\n<style type="text/css"><![CDATA[.sticker { stroke: #000000; stroke-width: 1px; }]]></style>\n'+Le.join("")+"</svg>";return this.svggrips=Ee,_e}},{key:"dist",value:function(e,t){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}},{key:"triarea",value:function(e,t,r){var i=this.dist(e,t),n=this.dist(t,r),s=this.dist(e,r),a=(i+n+s)/2;return Math.sqrt(a*(a-i)*(a-n)*(a-s))}},{key:"polyarea",value:function(e){for(var t=0,r=2;r<e.length;r++)t+=this.triarea(e[0],e[1],e[r]);return t}},{key:"get3d",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.77,t=arguments.length>1?arguments[1]:void 0,r=[],i=[],n=this.getInitial3DRotation(),s=[],a=.52*this.basefaces[0][0].len(),o=0,h=0;h<this.basefaces.length;h++){var f=n.rotateface(this.basefaces[h]),u=this.facenames[h][1];s.push({coords:Y(f,a),name:u}),o+=this.polyarea(s[h].coords)}o/=this.faces.length;for(var l=Math.sqrt(o)*(1-Math.sqrt(e))/2,c=0;c<this.faces.length;c++){var v=Math.floor(c/this.stickersperface),m=this.facetocubies[c][0],p=this.facetocubies[c][1],g=this.cubiesetnums[m],d=this.cubieordnums[m],b=this.graybyori(m)?"#808080":this.colors[this.facenames[v][1]];(null==t?void 0:t.stickerColors)&&(b=t.stickerColors[c]);var y=n.rotateface(this.faces[c]);i.push({coords:Y(y,a),color:b,orbit:this.cubiesetnames[g],ord:d,ori:p});var w=y;if(l&&l>0&&(y=ee(y,l)),r.push({coords:Y(y,a),color:b,orbit:this.cubiesetnames[g],ord:d,ori:p}),this.duplicatedFaces[c])for(var k=1;k<this.duplicatedFaces[c];k++)r.push({coords:Y(y,a),color:b,orbit:this.cubiesetnames[g],ord:d,ori:k}),i.push({coords:Y(w,a),color:b,orbit:this.cubiesetnames[g],ord:d,ori:k})}for(var L=[],z=0;z<this.movesetgeos.length;z++)for(var x=this.movesetgeos[z],M=this.movesetorders[z],F=0;F<this.geonormals.length;F++){var A=this.geonormals[F];x[0]===A[1]&&x[1]===A[2]&&(L.push([X(A[0].rotatepoint(n),1),x[0],M]),L.push([X(A[0].rotatepoint(n).smul(-1),1),x[2],M]))}var B=function(e){return this.unswizzle(e)}.bind(this);return{stickers:r,foundations:i,faces:s,axis:L,unswizzle:B,notationMapper:this.notationMapper}}},{key:"getGeoNormal",value:function(e){for(var t=this.getInitial3DRotation(),r=this.swizzler.unswizzle(e),i=0;i<this.geonormals.length;i++){var n=this.geonormals[i];if(r===n[1]){var s=X(n[0].rotatepoint(t),1);return Math.abs(s[0])<G&&Math.abs(s[2])<G&&(s[0]=0,s[2]=1e-6),s}}}},{key:"getfaceindex",value:function(e){var t=this.stickersperface;return Math.floor(e/t)}}]),e}(),re=function(){function e(t,r){Object(o.a)(this,e),this.pg=t,this.cache={},this.orbitNames=r.orbitnames}return Object(h.a)(e,[{key:"lookupMove",value:function(e){var t=this.moveToKeyString(e);if(t in this.cache)return this.cache[t];var r=this.pg.parseMove(e),i=[r[2],r[3]];if(!r[4]){var n=this.pg.moveplanesets[r[1]].length;i=[n-r[3],n-r[2]]}var s=this.pg.getMoveFromBits(i,r[5],!r[4],this.pg.cmovesbyslice[r[1]],void 0,this.pg.movesetorders[r[1]]),a=d.transformToKPuzzle(this.orbitNames,s);return this.cache[t]=a,a}},{key:"moveToKeyString",value:function(e){var t="";return e.outerLayer&&(t=t+e.outerLayer+","),e.innerLayer&&(t=t+e.innerLayer+","),t=t+e.family+","+e.effectiveAmount}}]),e}(),ie=function(){function e(){Object(o.a)(this,e),this.mult=[]}return Object(h.a)(e,[{key:"multiply",value:function(e){for(var t=2;t*t<=e;t++)for(;e%t===0;)void 0!==this.mult[t]?this.mult[t]++:this.mult[t]=1,e/=t;e>1&&(void 0!==this.mult[e]?this.mult[e]++:this.mult[e]=1)}},{key:"toString",value:function(){for(var e="",t=0;t<this.mult.length;t++)void 0!==this.mult[t]&&(""!==e&&(e+="*"),e+=t,this.mult[t]>1&&(e+="^"+this.mult[t]));return e}}]),e}();function ne(e,t){var r=e[0].p.length,i=function(e){return new p(v(e))}(r),n=[],s=[],a=[],o=[],h=[];function f(e,t,r){o[e].push(t),h[e].push(r);for(var i=0;i<n[e].length;i++)n[e][i]&&u(e,n[e][i].mul(t),r+a[e][i])}function u(e,t,r){var i=t.p[e];if(n[e][i]){var l=t.mul(s[e][i]);(function(e){for(var t=e.p.length-1;t>=0;t--){var r=e.p[t];if(r!==t){if(!n[t][r])return!1;e=e.mul(s[t][r])}}return!0})(l)||f(e-1,l,r+a[e][i])}else{n[e][i]=t,s[e][i]=t.inv(),a[e][i]=r;for(var c=0;c<o[e].length;c++)u(e,t.mul(o[e][c]),r+h[e][c])}}return function(){n=[],s=[],o=[],a=[],h=[];for(var u=0;u<r;u++)n.push([]),s.push([]),a.push([]),o.push([]),h.push([]),n[u][u]=i,s[u][u]=i,a[u][u]=0;for(var l=0,c=1,v=0;v<e.length;v++){f(r-1,e[v],1),c=1;for(var m=0,p=0,g=[],d=new ie,b=0;b<r;b++){for(var y=0,w=0,k=0;k<r;k++)n[b][k]&&(y++,w+=a[b][k],b!==k&&l++);m+=o[b].length,c*=y,y>1&&d.multiply(y);var L=w/y;g.push(L),p+=L}t(v+": sz "+c+" T "+m+" sol "+p+" none "+l+" mults "+d)}return c}()}}}]);
//# sourceMappingURL=3.8490f362.chunk.js.map